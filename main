--[[
  Garden Tower Defense - Toxic Map Hard Mode Full Auto Win + Macro/Replay + Mobile GUI
  Ã–zellikler: Full Auto Win, HazÄ±r Macro/Replay, Discord Webhook (mobile uyumlu), SÃ¼rÃ¼klenebilir, KÃ¼Ã§Ã¼ltÃ¼lebilir, KapatÄ±labilir, Mobil ekran boyutuna duyarlÄ± GUI
  KullanÄ±m: Sadece Ã§alÄ±ÅŸtÄ±r!
  Author: ZWCscripts iÃ§in mobil optimize
--]]

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UIS = game:GetService("UserInputService")

-- Ekran boyutuna gÃ¶re ayar
local screenW, screenH = workspace.CurrentCamera.ViewportSize.X, workspace.CurrentCamera.ViewportSize.Y
local guiW, guiH = math.min(340, screenW-40), math.min(320, screenH-80)

-- ========== GUI Setup ==========
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "GTD_MobileSuperWin_GUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0,guiW,0,guiH)
MainFrame.Position = UDim2.new(0,screenW/2-guiW/2,0,screenH/2-guiH/2)
MainFrame.BackgroundColor3 = Color3.fromRGB(35,35,35)
MainFrame.BorderSizePixel = 0
MainFrame.AnchorPoint = Vector2.new(0,0)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1,0,0,38)
TitleBar.Position = UDim2.new(0,0,0,0)
TitleBar.BackgroundColor3 = Color3.fromRGB(25,40,80)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Text = "GTD Toxic Hard Mobile Macro"
Title.Size = UDim2.new(1,-64,1,0)
Title.Position = UDim2.new(0,10,0,0)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = Enum.Font.GothamBold
Title.TextScaled = true
Title.Parent = TitleBar

local MinBtn = Instance.new("TextButton")
MinBtn.Text = "_"
MinBtn.Size = UDim2.new(0,32,1,0)
MinBtn.Position = UDim2.new(1,-64,0,0)
MinBtn.BackgroundColor3 = Color3.fromRGB(70,70,140)
MinBtn.TextColor3 = Color3.new(1,1,1)
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextScaled = true
MinBtn.Parent = TitleBar

local CloseBtn = Instance.new("TextButton")
CloseBtn.Text = "X"
CloseBtn.Size = UDim2.new(0,32,1,0)
CloseBtn.Position = UDim2.new(1,-32,0,0)
CloseBtn.BackgroundColor3 = Color3.fromRGB(180,50,50)
CloseBtn.TextColor3 = Color3.new(1,1,1)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextScaled = true
CloseBtn.Parent = TitleBar

local MainContent = Instance.new("Frame")
MainContent.Size = UDim2.new(1,0,1,-38)
MainContent.Position = UDim2.new(0,0,0,38)
MainContent.BackgroundTransparency = 1
MainContent.Parent = MainFrame

local Status = Instance.new("TextLabel")
Status.Text = "HazÄ±r! Webhooku gir ve baÅŸlat."
Status.Size = UDim2.new(1,-20,0,28)
Status.Position = UDim2.new(0,10,0,10)
Status.BackgroundTransparency = 1
Status.TextColor3 = Color3.new(1,1,1)
Status.Font = Enum.Font.Gotham
Status.TextScaled = true
Status.Parent = MainContent

local WebhookBox = Instance.new("TextBox")
WebhookBox.Text = ""
WebhookBox.Size = UDim2.new(1,-20,0,28)
WebhookBox.Position = UDim2.new(0,10,0,46)
WebhookBox.BackgroundColor3 = Color3.fromRGB(28,28,38)
WebhookBox.TextColor3 = Color3.new(1,1,1)
WebhookBox.Font = Enum.Font.Code
WebhookBox.TextScaled = true
WebhookBox.PlaceholderText = "Discord Webhook URL"
WebhookBox.Parent = MainContent

local MacroDropdown = Instance.new("TextButton")
MacroDropdown.Text = "Meta Macro: Farmer+PalmTree"
MacroDropdown.Size = UDim2.new(1,-20,0,28)
MacroDropdown.Position = UDim2.new(0,10,0,82)
MacroDropdown.BackgroundColor3 = Color3.fromRGB(38,48,38)
MacroDropdown.TextColor3 = Color3.new(1,1,1)
MacroDropdown.Font = Enum.Font.Code
MacroDropdown.TextScaled = true
MacroDropdown.Parent = MainContent

local StartBtn = Instance.new("TextButton")
StartBtn.Text = "Otomatik Win'i BaÅŸlat (Macro ile)"
StartBtn.Size = UDim2.new(1,-20,0,34)
StartBtn.Position = UDim2.new(0,10,0,120)
StartBtn.BackgroundColor3 = Color3.fromRGB(0,171,116)
StartBtn.TextColor3 = Color3.new(1,1,1)
StartBtn.Font = Enum.Font.GothamBold
StartBtn.TextScaled = true
StartBtn.Parent = MainContent

local WebhookTestBtn = Instance.new("TextButton")
WebhookTestBtn.Text = "Webhook Test MesajÄ±"
WebhookTestBtn.Size = UDim2.new(1,-20,0,34)
WebhookTestBtn.Position = UDim2.new(0,10,0,164)
WebhookTestBtn.BackgroundColor3 = Color3.fromRGB(85,85,255)
WebhookTestBtn.TextColor3 = Color3.new(1,1,1)
WebhookTestBtn.Font = Enum.Font.GothamBold
WebhookTestBtn.TextScaled = true
WebhookTestBtn.Parent = MainContent

local ErrorLabel = Instance.new("TextLabel")
ErrorLabel.Text = ""
ErrorLabel.Size = UDim2.new(1,-20,0,50)
ErrorLabel.Position = UDim2.new(0,10,0,210)
ErrorLabel.BackgroundTransparency = 1
ErrorLabel.TextColor3 = Color3.new(1,0.4,0.4)
ErrorLabel.Font = Enum.Font.Gotham
ErrorLabel.TextScaled = true
ErrorLabel.Visible = false
ErrorLabel.Parent = MainContent

local Credits = Instance.new("TextLabel")
Credits.Text = "Script: ZWCscripts | Meta Macro | Mobil Uyumlu"
Credits.Size = UDim2.new(1,-20,0,22)
Credits.Position = UDim2.new(0,10,1,-30)
Credits.BackgroundTransparency = 1
Credits.TextColor3 = Color3.fromRGB(120,180,120)
Credits.Font = Enum.Font.Gotham
Credits.TextScaled = true
Credits.Parent = MainContent

-- ========== KÃ¼Ã§Ã¼lt/Kapat FonksiyonlarÄ± ==========
local minimized = false
MinBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    MainContent.Visible = not minimized
    MinBtn.Text = minimized and "+" or "_"
end)
CloseBtn.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- ========== HazÄ±r Macro DosyasÄ± (GÃ¼ncel Meta) ==========
local macroData = {
    {round=1, unit="Farmer", pos=Vector3.new(8, 1, -23)},
    {round=1, unit="PalmTree", pos=Vector3.new(12, 1, -25)},
    {round=2, unit="Farmer", pos=Vector3.new(10, 1, -23)},
    {round=2, unit="PalmTree", pos=Vector3.new(14, 1, -25)},
    -- daha fazla hamle eklenebilir!
}

-- ========== Hata Fonksiyonu ==========
local function reportError(msg)
    ErrorLabel.Text = "HATA:\n" .. msg
    ErrorLabel.Visible = true
    Status.Text = "Bir hata oluÅŸtu!"
end

-- ========== Webhook Mobile Fonksiyonu (RequestAsync ile) ==========
local function sendWebhook(content)
    local url = WebhookBox.Text
    if url == "" or not string.find(url,"discord.com/api/webhook") then
        reportError("GeÃ§erli Discord webhook URL girilmedi.")
        return false
    end
    local data = HttpService:JSONEncode({username="GTD SuperWin",content=content})
    local result
    local isok,err = pcall(function()
        result = HttpService:RequestAsync({
            Url = url,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = data
        })
    end)
    if not isok or not result.Success then
        reportError("Webhook gÃ¶nderilemedi: " .. (result and result.StatusCode or "") .. " " .. tostring(err))
        return false
    end
    return true
end

WebhookTestBtn.MouseButton1Click:Connect(function()
    local ok = sendWebhook("Webhook baÅŸarÄ±yla Ã§alÄ±ÅŸÄ±yor! ðŸ‘‘")
    if ok then Status.Text = "Test mesajÄ± gÃ¶nderildi âœ…" end
end)

-- ========== Ana Macro/AutoWin Fonksiyonu ==========
StartBtn.MouseButton1Click:Connect(function()
    Status.Text = "BaÅŸlatÄ±lÄ±yor..."
    ErrorLabel.Visible = false

    local gameData = workspace:FindFirstChild("Game") or workspace:FindFirstChild("GameSession")
    if not gameData then reportError("Oyun verisi bulunamadÄ±!") return end

    local mapName = gameData:FindFirstChild("MapName") and gameData.MapName.Value or ""
    local modeName = gameData:FindFirstChild("Mode") and gameData.Mode.Value or ""
    if string.lower(mapName) ~= "toxic" then reportError("Åžu anda Toxic mapte deÄŸilsin!") return end
    if string.lower(modeName) ~= "hard" then reportError("Åžu anda Hard modda deÄŸilsin!") return end

    local units = {}
    local unitListModule = ReplicatedStorage:FindFirstChild("Units")
    if not unitListModule then reportError("Unit veri modÃ¼lÃ¼ bulunamadÄ±!") return end
    local unitList = require(unitListModule)
    for name,unit in pairs(unitList) do
        if string.lower(name):find("farmer") then units["Farmer"] = unit end
        if string.lower(name):find("palm") then units["PalmTree"] = unit end
    end
    if not units["Farmer"] or not units["PalmTree"] then reportError("Farmer veya PalmTree unitleri bulunamadÄ±!") return end

    local PlaceUnitRemote = ReplicatedStorage:FindFirstChild("Events")
        and ReplicatedStorage.Events:FindFirstChild("PlaceUnit")
    if not PlaceUnitRemote then reportError("PlaceUnit eventi bulunamadÄ±!") return end

    for _,step in ipairs(macroData) do
        local unitObj = units[step.unit]
        if unitObj then
            pcall(function()
                PlaceUnitRemote:FireServer(unitObj, step.pos)
            end)
        end
        wait(0.45)
    end

    Status.Text = "Macro tamamlandÄ±, win bekleniyor..."

    local playerStats = LocalPlayer:FindFirstChild("Stats")
    local seeds = playerStats and playerStats:FindFirstChild("Seeds") and playerStats.Seeds.Value or "?"
    local wins = playerStats and playerStats:FindFirstChild("Wins") and playerStats.Wins.Value or "?"

    local ok = sendWebhook("MaÃ§ bitti! Toplam seed: "..tostring(seeds)..", Win sayÄ±sÄ±: "..tostring(wins))
    if ok then
        Status.Text = "Win alÄ±ndÄ±! Discord'a gÃ¶nderildi âœ…"
    else
        Status.Text = "Win alÄ±ndÄ±, fakat Discord'a gÃ¶nderilemedi."
    end
end)

-- ========== Mobil SÃ¼rÃ¼kleme (Dokunmatik destek) ==========
local dragging, dragInput, dragStart, startPos
TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)
TitleBar.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement) then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(0, math.clamp(startPos.X.Offset + delta.X, 0, screenW-guiW), 0, math.clamp(startPos.Y.Offset + delta.Y, 0, screenH-guiH))
    end
end)

Status.Text = "TÃ¼m kontroller tamamlandÄ±. Mobilde Ã§alÄ±ÅŸmaya hazÄ±r!"
ScreenGui.Enabled = true
